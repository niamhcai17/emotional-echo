{% extends "base.html" %}

{% block title %}Entrelíneas - Bienvenido{% endblock %}

{% block content %}
<div class="hero-section">
    <div class="row justify-content-center">
        <div class="col-lg-6">
            <div class="text-center mb-5">
                <h1 class="hero-title">Entrelíneas</h1>
                <p class="hero-subtitle">Transforma tus emociones en elegantes frases poéticas</p>
            </div>

            <!-- Auth Forms -->
            <div class="welcome-form-card">
                <div class="text-center mb-4">
                    <i class="fas fa-heart text-danger fa-3x mb-3"></i>
                    <h4>¡Bienvenido a Entrelíneas!</h4>
                    <p class="text-muted">Para comenzar a crear frases poéticas, inicia sesión o regístrate</p>
                </div>
                
                <!-- Auth Toggle Buttons -->
                <div class="text-center mb-4">
                    <div class="btn-group" role="group">
                        <button type="button" class="btn btn-outline-primary active" id="loginToggle">Iniciar Sesión</button>
                        <button type="button" class="btn btn-outline-primary" id="registerToggle">Registrarse</button>
                    </div>
                </div>
                
                <!-- Login Form -->
                <form id="loginForm" method="POST" action="{{ url_for('login') }}">
                    <div class="mb-3">
                        <label for="loginUsername" class="form-label">Nombre de usuario</label>
                        <input type="text" class="form-control" id="loginUsername" name="username" required>
                    </div>
                    
                    <div class="mb-3">
                        <label for="loginEmail" class="form-label">Correo electrónico</label>
                        <input type="email" class="form-control" id="loginEmail" name="email" required>
                    </div>
                    
                    <div class="mb-3">
                        <label for="loginPassword" class="form-label">Contraseña</label>
                        <input type="password" class="form-control" id="loginPassword" name="password" required>
                    </div>
                    
                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-primary btn-lg">
                            <i class="fas fa-sign-in-alt me-2"></i>Iniciar Sesión
                        </button>
                    </div>
                </form>
                
                <!-- Register Form -->
                <form id="registerForm" method="POST" action="{{ url_for('register') }}" style="display: none;">
                    <div class="mb-3">
                        <label for="registerUsername" class="form-label">Nombre de usuario</label>
                        <input type="text" class="form-control" id="registerUsername" name="username" required>
                    </div>
                    
                    <div class="mb-3">
                        <label for="registerEmail" class="form-label">Correo electrónico</label>
                        <input type="email" class="form-control" id="registerEmail" name="email" required>
                    </div>
                    
                    <div class="mb-3">
                        <label for="registerPassword" class="form-label">Contraseña</label>
                        <input type="password" class="form-control" id="registerPassword" name="password" required minlength="6">
                        <div class="form-text">Mínimo 6 caracteres</div>
                    </div>
                    
                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-success btn-lg">
                            <i class="fas fa-user-plus me-2"></i>Crear Cuenta
                        </button>
                    </div>
                </form>
                
                <div class="text-center mt-4">
                    <p class="text-muted">O continúa con</p>
                    <button id="googleLoginBtn" class="btn btn-outline-dark">
                        <i class="fab fa-google me-2"></i>Google
                    </button>
                </div>
                
                <div class="mt-3">
                    <small class="text-muted">Tu información se mantiene segura y solo se usa para personalizar tu experiencia</small>
                </div>
            </div>

            <!-- Features -->
            <div class="features mt-5">
                <h3 class="text-center mb-4">¿Qué puedes hacer?</h3>
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <div class="feature-card text-center">
                            <i class="fas fa-feather-alt text-primary fa-2x mb-3"></i>
                            <h5>Crear frases poéticas</h5>
                            <p class="text-muted">Transforma tus emociones en hermosas frases</p>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="feature-card text-center">
                            <i class="fas fa-heart text-danger fa-2x mb-3"></i>
                            <h5>Guardar favoritos</h5>
                            <p class="text-muted">Mantén tus frases favoritas organizadas</p>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="feature-card text-center">
                            <i class="fas fa-chart-bar text-success fa-2x mb-3"></i>
                            <h5>Ver estadísticas</h5>
                            <p class="text-muted">Descubre tus patrones emocionales</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Supabase Auth Script -->
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script>
    // Configuración de Supabase
    const supabaseUrl = '{{ config.SUPABASE_URL }}';
    const supabaseAnonKey = '{{ config.SUPABASE_ANON_KEY }}';
    const supabase = supabase.createClient(supabaseUrl, supabaseAnonKey);

    // Toggle entre login y registro
    document.getElementById('loginToggle').addEventListener('click', function() {
        document.getElementById('loginToggle').classList.add('active');
        document.getElementById('registerToggle').classList.remove('active');
        document.getElementById('loginForm').style.display = 'block';
        document.getElementById('registerForm').style.display = 'none';
    });

    document.getElementById('registerToggle').addEventListener('click', function() {
        document.getElementById('registerToggle').classList.add('active');
        document.getElementById('loginToggle').classList.remove('active');
        document.getElementById('registerForm').style.display = 'block';
        document.getElementById('loginForm').style.display = 'none';
    });

    // Función para login con Google
    async function signInWithGoogle() {
        try {
            const { data, error } = await supabase.auth.signInWithOAuth({
                provider: 'google',
                options: {
                    redirectTo: window.location.origin + '/auth/callback'
                }
            });
            
            if (error) {
                console.error('Error en login:', error);
                alert('Error al iniciar sesión. Por favor, inténtalo de nuevo.');
            }
        } catch (error) {
            console.error('Error inesperado:', error);
            alert('Error inesperado. Por favor, inténtalo de nuevo.');
        }
    }

    // Event listener para el botón de login
    document.getElementById('googleLoginBtn').addEventListener('click', signInWithGoogle);

    // Verificar si ya está autenticado
    async function checkAuth() {
        const { data: { user } } = await supabase.auth.getUser();
        if (user) {
            // Si ya está autenticado, redirigir a la página principal
            window.location.href = '/';
        }
    }

    // Verificar autenticación al cargar la página
    checkAuth();
</script>
{% endblock %}
